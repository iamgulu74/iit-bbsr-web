<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigation Test - Cosmic Watch</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" />
    <link rel="stylesheet" href="css/mdb.min.css" />
    <link rel="stylesheet" href="css/app.css" />
    <style>
        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }

        .test-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            display: inline-block;
            margin: 5px 0;
        }

        .success {
            background: #198754;
            color: white;
        }

        .error {
            background: #dc3545;
            color: white;
        }

        .info {
            background: #0dcaf0;
            color: black;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1><i class="fas fa-vial me-2 text-success"></i>Navigation & Authentication Test</h1>

        <div class="test-section">
            <h3>Current Authentication State</h3>
            <div id="authStatus"></div>
            <div id="userData"></div>
        </div>

        <div class="test-section">
            <h3>Test Actions</h3>
            <button class="btn btn-success me-2" onclick="simulateLogin()">
                <i class="fas fa-sign-in-alt me-1"></i>Simulate Login
            </button>
            <button class="btn btn-danger me-2" onclick="logout()">
                <i class="fas fa-sign-out-alt me-1"></i>Logout
            </button>
            <button class="btn btn-info me-2" onclick="checkAuth()">
                <i class="fas fa-sync me-1"></i>Refresh Status
            </button>
            <button class="btn btn-warning" onclick="clearStorage()">
                <i class="fas fa-trash me-1"></i>Clear Storage
            </button>
        </div>

        <div class="test-section">
            <h3>Navigation Preview</h3>
            <div id="mainNav"></div>
        </div>

        <div class="test-section">
            <h3>Console Output</h3>
            <div id="console"
                style="background: #000; padding: 10px; border-radius: 4px; font-family: monospace; max-height: 300px; overflow-y: auto;">
            </div>
        </div>
    </div>

    <script type="text/javascript" src="js/mdb.umd.min.js"></script>
    <script type="text/javascript" src="js/app/config.js"></script>
    <script type="text/javascript" src="js/app/auth.js"></script>
    <script type="text/javascript" src="js/app/nav.js"></script>

    <script>
        // Log to both console and page
        function log(message, type = 'info') {
            const consoleDiv = document.getElementById('console');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : '#74c0fc';
            consoleDiv.innerHTML += `<div style="color: ${color};">[${timestamp}] ${message}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            console.log(message);
        }

        function checkAuth() {
            const isAuth = auth.isAuthenticated();
            const token = auth.getToken();
            const user = auth.getUser();

            const authStatus = document.getElementById('authStatus');
            if (isAuth) {
                authStatus.innerHTML = `<span class="status-badge success"><i class="fas fa-check-circle me-1"></i>AUTHENTICATED</span>`;
                log('✓ User is authenticated', 'success');
            } else {
                authStatus.innerHTML = `<span class="status-badge error"><i class="fas fa-times-circle me-1"></i>NOT AUTHENTICATED</span>`;
                log('✗ User is not authenticated', 'error');
            }

            const userData = document.getElementById('userData');
            if (user) {
                userData.innerHTML = `
                    <div class="mt-3">
                        <strong>User Data:</strong><br>
                        Username: ${user.username || 'N/A'}<br>
                        Email: ${user.email || 'N/A'}<br>
                        ID: ${user.id || 'N/A'}
                    </div>
                `;
                log(`User: ${user.username} (${user.email})`, 'info');
            } else {
                userData.innerHTML = '<div class="mt-3 text-muted">No user data</div>';
                log('No user data found', 'info');
            }

            if (token) {
                log(`Token: ${token.substring(0, 20)}...`, 'info');
            } else {
                log('No token found', 'info');
            }

            // Force re-render navigation
            if (typeof renderNav === 'function') {
                renderNav();
                log('Navigation re-rendered', 'success');
            }
        }

        function simulateLogin() {
            const mockUser = {
                id: '12345',
                username: 'TestUser',
                email: 'test@cosmicwatch.com'
            };
            const mockToken = 'mock-jwt-token-' + Date.now();

            auth.setUser(mockUser);
            auth.setToken(mockToken);

            log('Simulated login successful', 'success');
            checkAuth();
        }

        function logout() {
            auth.logout = function () {
                auth.removeToken();
                auth.removeUser();
                log('Logged out successfully', 'success');
                checkAuth();
            };
            auth.logout();
        }

        function clearStorage() {
            localStorage.clear();
            log('Local storage cleared', 'success');
            checkAuth();
        }

        // Override auth.logout to prevent redirect during testing
        const originalLogout = auth.logout;
        auth.logout = function () {
            auth.removeToken();
            auth.removeUser();
            log('Logged out (redirect prevented for testing)', 'success');
            checkAuth();
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function () {
            log('=== Test Page Loaded ===', 'success');
            checkAuth();
        });
    </script>
</body>

</html>
